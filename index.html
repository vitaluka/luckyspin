<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#050508">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LuckySpin Grand Luxury | The Definitive Edition</title>
    <!-- –®—Ä–∏—Ñ—Ç—ã -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;900&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <style>
        /* --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –¢–ï–ú–´ --- */
        :root {
            --p: #ff00ff; /* –ù–µ–æ–Ω–æ–≤—ã–π —Ä–æ–∑–æ–≤—ã–π */
            --c: #00f2ff; /* –ù–µ–æ–Ω–æ–≤—ã–π –≥–æ–ª—É–±–æ–π */
            --g: #ffcc00; /* –ó–æ–ª–æ—Ç–æ */
            --b: #050508; /* –ì–ª—É–±–æ–∫–∏–π —Ñ–æ–Ω */
            --surface: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --grad: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            --shadow: 0 0 20px rgba(255, 0, 255, 0.3);
        }

        body.theme-emerald { --p: #10b981; --c: #34d399; --grad: linear-gradient(135deg, #064e3b, #065f46); }
        body.theme-ruby { --p: #e11d48; --c: #fb7185; --grad: linear-gradient(135deg, #4c0519, #881337); }
        body.theme-gold { --p: #ffcc00; --c: #ffffff; --grad: linear-gradient(135deg, #434343, #000000); }

        /* --- –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò --- */
        * { 
            box-sizing: border-box; 
            margin: 0; padding: 0; 
            font-family: 'Montserrat', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        body {
            background: var(--b);
            background-image: var(--grad);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            background-attachment: fixed;
        }

        canvas#particle-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }

        /* --- –®–ê–ü–ö–ê --- */
        header {
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(20px);
            padding: 20px 5%;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid var(--p);
            position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .brand {
            font-family: 'Playfair Display', serif;
            font-size: 28px; font-weight: 900; letter-spacing: 2px;
            background: linear-gradient(to right, #fff, var(--g));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .balance-pill {
            background: var(--surface);
            border: 1px solid var(--g);
            padding: 10px 25px;
            border-radius: 100px;
            display: flex; align-items: center; gap: 15px;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.2);
            transition: 0.3s;
        }
        #balance-val { font-weight: 900; color: var(--g); font-size: 24px; }

        /* --- –ì–ï–†–û–ô –ò –ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–° --- */
        .hero {
            display: grid; grid-template-columns: 1.1fr 0.9fr;
            gap: 50px; padding: 80px 0; align-items: center;
        }

        .hero-info h1 {
            font-size: 64px; font-weight: 900; line-height: 1.1;
            margin-bottom: 25px; text-transform: uppercase;
        }
        .hero-info span { color: var(--p); text-shadow: 0 0 20px var(--p); }

        .daily-section {
            background: var(--surface); border: 1px solid var(--border);
            padding: 50px; border-radius: 50px; text-align: center;
            backdrop-filter: blur(15px); position: relative;
        }

        .wheel-outer {
            width: 320px; height: 320px; margin: 0 auto 30px;
            border: 10px solid var(--g); border-radius: 50%;
            position: relative; overflow: hidden;
            background: conic-gradient(
                #111 0deg 45deg, var(--p) 45deg 90deg, 
                #222 90deg 135deg, var(--c) 135deg 180deg,
                #111 180deg 225deg, var(--p) 225deg 270deg,
                #222 270deg 315deg, var(--c) 315deg 360deg
            );
            transition: transform 5s cubic-bezier(0.1, 0, 0.1, 1);
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        .wheel-pointer {
            position: absolute; top: -10px; left: 50%;
            transform: translateX(-50%); z-index: 10;
            width: 0; height: 0; border-left: 20px solid transparent;
            border-right: 20px solid transparent; border-top: 35px solid var(--g);
        }

        /* --- –ö–ù–û–ü–ö–ò --- */
        .btn-glam {
            background: linear-gradient(45deg, var(--p), var(--c));
            color: white; border: none; padding: 20px 50px;
            border-radius: 100px; font-weight: 900; font-size: 16px;
            cursor: pointer; text-transform: uppercase; letter-spacing: 2px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .btn-glam:hover:not(:disabled) { transform: translateY(-5px) scale(1.05); box-shadow: 0 0 30px var(--p); }
        .btn-glam:disabled { background: #333; cursor: not-allowed; opacity: 0.5; }

        /* --- –°–ï–¢–ö–ê –ò–ì–† --- */
        .grid-title {
            margin: 60px 0 30px; font-size: 32px; font-weight: 900;
            display: flex; align-items: center; gap: 20px; text-transform: uppercase;
        }
        .grid-title::after { content: ''; height: 2px; flex: 1; background: var(--border); }

        .games-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px; margin-bottom: 100px;
        }

        .game-card {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 40px; padding: 50px 30px; text-align: center;
            transition: 0.4s; cursor: pointer; position: relative; overflow: hidden;
        }
        .game-card:hover { transform: translateY(-15px); border-color: var(--p); background: rgba(255,255,255,0.1); }
        .game-card svg {
            width: 80px; height: 80px; margin-bottom: 30px;
            stroke: var(--c); fill: none; stroke-width: 1.5;
            filter: drop-shadow(0 0 15px var(--c));
        }
        .game-card h3 { font-size: 26px; font-weight: 900; margin-bottom: 15px; }
        .game-card p { opacity: 0.5; font-size: 15px; line-height: 1.6; }

        /* --- –†–ï–§–ï–†–ê–õ–ö–ê --- */
        .referral-box {
            background: var(--surface); border: 1px solid var(--g);
            padding: 30px; border-radius: 30px; margin-top: 40px;
            text-align: center;
        }
        .ref-input {
            background: rgba(0,0,0,0.5); border: 1px solid var(--border);
            padding: 10px 20px; border-radius: 10px; color: white;
            text-align: center; font-size: 18px; margin: 15px 0; width: 250px;
            max-width: 100%;
        }

        /* --- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê --- */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98); z-index: 2000;
            backdrop-filter: blur(25px); justify-content: center; align-items: center;
            padding: 10px;
        }
        .modal-content {
            background: #08080a; width: 95%; max-width: 750px; padding: 60px;
            border-radius: 50px; border: 2px solid var(--p); position: relative;
            text-align: center; box-shadow: 0 0 100px rgba(255, 0, 255, 0.1);
            max-height: 95vh; overflow-y: auto;
        }
        .close-modal { position: absolute; top: 30px; right: 40px; font-size: 45px; cursor: pointer; opacity: 0.3; }

        /* --- –ò–ì–†–û–í–´–ï –≠–õ–ï–ú–ï–ù–¢–´ --- */
        .bet-input-area {
            margin: 25px 0; background: rgba(255,255,255,0.05);
            padding: 20px; border-radius: 20px; border: 1px solid var(--border);
            display: inline-block;
        }
        .bet-input-area input {
            background: #000; border: 1px solid var(--g); color: var(--g);
            font-size: 28px; font-weight: 900; width: 150px; text-align: center;
            padding: 10px; border-radius: 10px; outline: none;
        }

        /* –°–ª–æ—Ç—ã */
        .slot-frame {
            display: flex; gap: 20px; justify-content: center; margin: 40px 0;
            background: #000; padding: 30px; border-radius: 30px; border: 2px solid var(--border);
            flex-wrap: wrap;
        }
        .slot-box {
            width: 120px; height: 160px; background: #050505; border-radius: 20px;
            display: flex; align-items: center; justify-content: center;
            font-size: 70px; border: 1px solid var(--border);
            text-shadow: 0 0 20px var(--c);
        }

        /* –ö–∞—Ä—Ç—ã */
        .card-area { display: flex; justify-content: center; gap: 15px; min-height: 150px; margin: 20px 0; flex-wrap: wrap; }
        .p-card {
            width: 90px; height: 130px; background: white; color: black;
            border-radius: 12px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; font-weight: 900;
            font-size: 28px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: cardSlide 0.4s ease-out;
        }
        @keyframes cardSlide { from { transform: translateY(100px) opacity: 0; } }

        /* –†—É–ª–µ—Ç–∫–∞ */
        #roulette-result {
            width: 140px; height: 140px; border-radius: 50%; margin: 20px auto;
            display: flex; align-items: center; justify-content: center;
            font-size: 52px; font-weight: 900; border: 5px solid white;
            box-shadow: 0 0 40px rgba(255,255,255,0.1);
        }

        /* –¶–∞—Ä–∞–ø–∫–∞ */
        #scratch-canvas {
            background: transparent; border-radius: 30px; cursor: crosshair;
            box-shadow: 0 0 40px rgba(255,255,255,0.05);
            max-width: 100%;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        #toast {
            position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%);
            background: white; color: black; padding: 20px 60px;
            border-radius: 100px; font-weight: 900; font-size: 22px;
            z-index: 9999; transition: 0.5s;
        }

        /* –§—É—Ç–µ—Ä */
        footer { text-align: center; padding: 100px 0; opacity: 0.3; font-size: 13px; }
        .danger-zone { margin-top: 30px; opacity: 1; }
        .reset-btn { color: #ff4444; cursor: pointer; text-decoration: underline; font-weight: bold; }

        /* --- –ú–û–ë–ò–õ–¨–ù–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø --- */
        @media (max-width: 768px) {
            header { padding: 10px 3%; }
            .brand { font-size: 22px; }
            .balance-pill { padding: 6px 15px; gap: 8px; }
            #balance-val { font-size: 18px; }

            .hero { grid-template-columns: 1fr; text-align: center; padding: 40px 0; }
            .hero-info h1 { font-size: 42px; }
            
            .daily-section { padding: 30px 15px; border-radius: 30px; }
            .wheel-outer { width: 250px; height: 250px; }

            .modal-content { padding: 40px 15px; border-radius: 30px; }
            .close-modal { top: 15px; right: 20px; font-size: 35px; }

            .slot-box { width: 80px; height: 110px; font-size: 45px; }
            .p-card { width: 70px; height: 100px; font-size: 22px; }
            .bet-input-area input { font-size: 22px; width: 120px; }
            
            .grid-title { font-size: 22px; }
            .game-card { padding: 30px 15px; border-radius: 25px; }
            .game-card svg { width: 60px; height: 60px; }
            .game-card h3 { font-size: 22px; }

            #toast { width: 90%; padding: 15px 20px; font-size: 18px; text-align: center; }
            .btn-glam { padding: 15px 30px; font-size: 14px; }
        }

    </style>
</head>
<body class="theme-default">

    <canvas id="particle-canvas"></canvas>

    <header>
        <div class="brand">LUCKY SPIN</div>
        <div class="balance-pill" id="bal-card">
            <span style="font-size: 28px;">üí∞</span>
            <span id="balance-val">1000</span>
        </div>
    </header>

    <main class="container">
        <!-- Hero: –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å -->
        <section class="hero">
            <div class="hero-info">
                <h1>FORTUNE<br><span>FAVORS</span> THE BOLD</h1>
                <p style="font-size: 20px; opacity: 0.6; margin-bottom: 40px;">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —à–∞–Ω—Å –∑–∞–±—Ä–∞—Ç—å 500 –º–æ–Ω–µ—Ç. –¢–≤–æ–π –ø—É—Ç—å –∫ –º–∏–ª–ª–∏–æ–Ω—É –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–¥–µ—Å—å.</p>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                    <button class="btn-glam" onclick="scrollToGrid()">–í –ò–ì–†–û–í–û–ô –ó–ê–õ</button>
                    <button class="btn-glam" style="background: var(--surface); border: 1px solid var(--border);" onclick="watchFakeAd()">–†–ï–ö–õ–ê–ú–ê (+250 üí∞)</button>
                </div>
                
                <!-- –†–µ—Ñ–µ—Ä–∞–ª–∫–∞ -->
                <div class="referral-box">
                    <p>–¢–≤–æ–π –∫–æ–¥: <strong id="my-ref-code" style="color:var(--g)">LUCKY-777</strong></p>
                    <input type="text" id="friend-code" class="ref-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥—Ä—É–≥–∞">
                    <br>
                    <button class="btn-glam" style="padding: 10px 30px; font-size: 12px;" onclick="claimReferral()">–í–í–ï–°–¢–ò –ö–û–î (+500)</button>
                </div>
            </div>
            <div class="daily-section">
                <div class="wheel-pointer"></div>
                <div class="wheel-outer" id="main-wheel"></div>
                <button class="btn-glam" id="daily-btn" onclick="spinDaily()">–ö–†–£–¢–ò–¢–¨ (500)</button>
                <p id="timer" style="margin-top: 20px; font-size: 14px; opacity: 0.5; font-weight: 700;"></p>
            </div>
        </section>

        <!-- –°–µ—Ç–∫–∞ –∏–≥—Ä -->
        <div class="grid-title">–í–´–ë–ï–†–ò–¢–ï –†–ï–ñ–ò–ú</div>
        <div class="games-grid" id="game-grid">
            <!-- Slots -->
            <div class="game-card" onclick="openGame('slots')">
                <svg viewBox="0 0 24 24"><path d="M19 5H5a2 2 0 00-2 2v10a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2zM7 5v14M12 5v14M17 5v14M2 12h20"></path></svg>
                <h3>ULTRA SLOTS</h3>
                <p>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –¥–∂–µ–∫–ø–æ—Ç 777. –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± —Ä–∞–∑–±–æ–≥–∞—Ç–µ—Ç—å.</p>
            </div>

            <!-- Blackjack -->
            <div class="game-card" onclick="openGame('blackjack')">
                <svg viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2z"></path><circle cx="9" cy="9" r="1.5" fill="currentColor"></circle><circle cx="15" cy="15" r="1.5" fill="currentColor"></circle></svg>
                <h3>PRO BLACKJACK</h3>
                <p>–ë–∏—Ç–≤–∞ —Å –¥–∏–ª–µ—Ä–æ–º. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∏ —Ö–ª–∞–¥–Ω–æ–∫—Ä–æ–≤–∏–µ –ø—Ä–∏–≤–µ–¥—É—Ç –∫ –ø–æ–±–µ–¥–µ.</p>
            </div>

            <!-- Roulette -->
            <div class="game-card" onclick="openGame('roulette')">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M12 2v20M2 12h20"></path><circle cx="12" cy="12" r="3"></circle></svg>
                <h3>GRAND ROULETTE</h3>
                <p>–°—Ç–∞–≤—å –Ω–∞ –ª—é–±–æ–π –Ω–æ–º–µ—Ä –∏ —Ü–≤–µ—Ç. –ü—Ä–æ–≤–µ—Ä—å —É–¥–∞—á—É –Ω–∞ –ó–µ—Ä–æ x35.</p>
            </div>

            <!-- Dice -->
            <div class="game-card" onclick="openGame('dice')">
                <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"></rect><circle cx="8" cy="8" r="1.5" fill="currentColor"></circle><circle cx="16" cy="16" r="1.5" fill="currentColor"></circle></svg>
                <h3>ORBITAL DICE</h3>
                <p>–£–≥–∞–¥–∞–π: –ß–µ—Ç–Ω–æ–µ –∏–ª–∏ –ù–µ—á–µ—Ç–Ω–æ–µ? –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –±—Ä–æ—Å–æ–∫ –∫–æ—Å—Ç–µ–π.</p>
            </div>

            <!-- Scratch -->
            <div class="game-card" onclick="openGame('scratch')">
                <svg viewBox="0 0 24 24"><path d="M20 7h-9m9 4h-9m9 4h-9M4 7h4v10H4z"></path></svg>
                <h3>SCRATCH LUCK</h3>
                <p>–°—Ç–∏—Ä–∞–π –∑–∞—â–∏—Ç–Ω—ã–π —Å–ª–æ–π –∏ –Ω–∞—Ö–æ–¥–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑—ã (—Ä–∞–∑ –≤ —á–∞—Å).</p>
            </div>

            <!-- Shop -->
            <div class="game-card" onclick="openGame('shop')">
                <svg viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4H6z"></path><path d="M3 6h18M16 10a4 4 0 01-8 0"></path></svg>
                <h3>THE VAULT</h3>
                <p>–ú–∞–≥–∞–∑–∏–Ω —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —Ç–µ–º –∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.</p>
            </div>
        </div>

        <footer>
            <p>&copy; 2025 LUCKY SPIN CASINO SIMULATOR. ALL RIGHTS RESERVED.</p>
            <div class="danger-zone">
                <span class="reset-btn" onclick="hardReset()">–°–ë–†–û–°–ò–¢–¨ –ü–†–û–ì–†–ï–°–° –ò –î–ê–ù–ù–´–ï</span>
            </div>
        </footer>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="modal-ui"></div>
        </div>
    </div>

    <div id="toast">–í–´–ò–ì–†–´–®!</div>

    <!-- JS ENGINE -->
    <script>
        /* --- –ó–í–£–ö–û–í–û–ô –î–í–ò–ñ–û–ö --- */
        const aCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSfx(f, type, d, v = 0.1) {
            const o = aCtx.createOscillator();
            const g = aCtx.createGain();
            o.type = type; o.frequency.value = f;
            g.gain.setValueAtTime(v, aCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.0001, aCtx.currentTime + d);
            o.connect(g); g.connect(aCtx.destination);
            o.start(); o.stop(aCtx.currentTime + d);
        }

        const sfx = {
            click: () => playSfx(600, 'sine', 0.1),
            win: () => { playSfx(523, 'square', 0.2); setTimeout(()=>playSfx(659,'square',0.2),100); setTimeout(()=>playSfx(783,'square',0.4),200); },
            lose: () => playSfx(150, 'sawtooth', 0.5),
            spin: () => playSfx(Math.random()*300+300, 'sine', 0.05),
            card: () => playSfx(400, 'triangle', 0.1)
        };

        /* --- –°–û–°–¢–û–Ø–ù–ò–ï --- */
        let state = {
            bal: 1000,
            lastDaily: 0,
            lastScratch: 0,
            unlocked: ['theme-default'],
            theme: 'theme-default',
            refClaimed: false
        };

        /* --- –Ø–î–†–û --- */
        function save() { localStorage.setItem('luckyspin_definitive_v3', JSON.stringify(state)); }
        function load() {
            const d = localStorage.getItem('luckyspin_definitive_v3');
            if(d) state = JSON.parse(d);
            updateBalance(0);
            applyTheme(state.theme);
        }

        function updateBalance(amt) {
            state.bal += amt;
            document.getElementById('balance-val').innerText = Math.floor(state.bal);
            const card = document.getElementById('bal-card');
            if(amt !== 0) {
                card.style.transform = 'scale(1.2)';
                setTimeout(()=>card.style.transform='scale(1)', 200);
            }
            if(amt > 0) {
                showToast(`+${amt} üí∞`);
                sfx.win();
                confettiBurst();
            }
            save();
        }

        function showToast(m) {
            const t = document.getElementById('toast');
            t.innerText = m; t.style.bottom = '50px';
            setTimeout(()=>t.style.bottom='-100px', 3000);
        }

        /* --- –ß–ê–°–¢–ò–¶–´ –ù–ê –§–û–ù–ï --- */
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        let parts = [];
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = resize; resize();

        class Particle {
            constructor() { this.init(); }
            init() {
                this.x = Math.random()*canvas.width;
                this.y = Math.random()*canvas.height;
                this.s = Math.random()*2;
                this.v = Math.random()*0.5 + 0.1;
                this.c = Math.random() > 0.5 ? getComputedStyle(document.body).getPropertyValue('--p') : getComputedStyle(document.body).getPropertyValue('--c');
            }
            draw() {
                ctx.fillStyle = this.c;
                ctx.globalAlpha = 0.2;
                ctx.beginPath(); ctx.arc(this.x, this.y, this.s, 0, 7); ctx.fill();
                this.y -= this.v; if(this.y < 0) this.init();
            }
        }
        for(let i=0; i<80; i++) parts.push(new Particle());

        function confettiBurst() {
            for(let i=0; i<40; i++) {
                parts.push({
                    x: canvas.width/2, y: canvas.height/2,
                    s: Math.random()*6+2, vx: (Math.random()-0.5)*15, vy: (Math.random()-0.5)*15,
                    life: 1, confetti: true,
                    draw() {
                        this.x += this.vx; this.y += this.vy; this.vy += 0.3; this.life -= 0.02;
                        ctx.fillStyle = `hsl(${Math.random()*360}, 100%, 50%)`;
                        ctx.globalAlpha = this.life;
                        ctx.fillRect(this.x, this.y, this.s, this.s);
                    }
                });
            }
        }

        function anim() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            parts.forEach((p, i) => {
                p.draw();
                if(p.confetti && p.life <= 0) parts.splice(i, 1);
            });
            requestAnimationFrame(anim);
        }
        anim();

        /* --- –ú–û–î–ê–õ–ö–ò --- */
        function openGame(g) {
            sfx.click();
            document.getElementById('modal').style.display = 'flex';
            const ui = document.getElementById('modal-ui');
            ui.innerHTML = '';
            
            if(g === 'slots') initSlots(ui);
            if(g === 'blackjack') initBJ(ui);
            if(g === 'roulette') initRoulette(ui);
            if(g === 'dice') initDice(ui);
            if(g === 'scratch') initScratch(ui);
            if(g === 'shop') initShop(ui);
        }
        function closeModal() { document.getElementById('modal').style.display = 'none'; sfx.click(); }

        /* --- –ò–ì–†–ê: –°–õ–û–¢–´ --- */
        const SLOTS_ITEMS = ['üíé', 'üçã', 'üçí', 'üîî', 'üçá', '7Ô∏è‚É£'];
        function initSlots(ui) {
            ui.innerHTML = `
                <h2>ULTRA SLOTS</h2>
                <div class="slot-frame">
                    <div class="slot-box" id="s1">üíé</div>
                    <div class="slot-box" id="s2">üíé</div>
                    <div class="slot-box" id="s3">üíé</div>
                </div>
                <div class="bet-input-area">–°–¢–ê–í–ö–ê: <input type="number" id="bet-val" value="50"></div>
                <br>
                <button class="btn-glam" id="spin-btn" onclick="playSlots()">–í–†–ê–©–ê–¢–¨</button>
            `;
        }
        function playSlots() {
            const bet = parseInt(document.getElementById('bet-val').value);
            if(bet > state.bal || bet <= 0) return showToast("–ú–ê–õ–û –ú–û–ù–ï–¢!");
            updateBalance(-bet);
            const btn = document.getElementById('spin-btn');
            btn.disabled = true;
            let c = 0;
            const iv = setInterval(() => {
                sfx.spin();
                document.getElementById('s1').innerText = SLOTS_ITEMS[Math.floor(Math.random()*6)];
                document.getElementById('s2').innerText = SLOTS_ITEMS[Math.floor(Math.random()*6)];
                document.getElementById('s3').innerText = SLOTS_ITEMS[Math.floor(Math.random()*6)];
                if(++c > 20) {
                    clearInterval(iv);
                    const r = [document.getElementById('s1').innerText, document.getElementById('s2').innerText, document.getElementById('s3').innerText];
                    if(r[0]===r[1] && r[1]===r[2]) updateBalance(bet*10);
                    else if(r[0]===r[1] || r[1]===r[2] || r[0]===r[2]) updateBalance(bet*2);
                    else sfx.lose();
                    btn.disabled = false;
                }
            }, 70);
        }

        /* --- –ò–ì–†–ê: –ë–õ–≠–ö–î–ñ–ï–ö --- */
        let deck, pHand, dHand, bjBet;
        function initBJ(ui) {
            ui.innerHTML = `
                <h2>PRO BLACKJACK</h2>
                <div style="margin: 20px 0;">
                    <p style="opacity: 0.5;">–î–ò–õ–ï–†: <span id="ds">0</span></p>
                    <div id="d-cards" class="card-area"></div>
                    <p style="opacity: 0.5;">–í–´: <span id="ps">0</span></p>
                    <div id="p-cards" class="card-area"></div>
                </div>
                <div id="bj-ui">
                    <div class="bet-input-area">–°–¢–ê–í–ö–ê: <input type="number" id="bet-val" value="100"></div><br>
                    <button class="btn-glam" onclick="startBJ()">–ù–ê–ß–ê–¢–¨</button>
                </div>
            `;
        }
        function startBJ() {
            bjBet = parseInt(document.getElementById('bet-val').value);
            if(bjBet > state.bal || bjBet <= 0) return;
            updateBalance(-bjBet);
            deck = []; const s = ['‚ô†','‚ô£','‚ô•','‚ô¶'], v = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            for(let x of s) for(let y of v) deck.push({v:y, s:x});
            deck.sort(() => Math.random()-0.5);
            pHand = [deck.pop(), deck.pop()]; dHand = [deck.pop()];
            renderBJ();
            document.getElementById('bj-ui').innerHTML = `
                <button class="btn-glam" onclick="bjMove('hit')">–ï–©–ï</button>
                <button class="btn-glam" style="background:#444" onclick="bjMove('stand')">–•–í–ê–¢–ò–¢</button>
            `;
        }
        function renderBJ() {
            const p = document.getElementById('p-cards'), d = document.getElementById('d-cards');
            p.innerHTML = ''; d.innerHTML = '';
            pHand.forEach(c => p.innerHTML += `<div class="p-card"><span>${c.v}</span><small>${c.s}</small></div>`);
            dHand.forEach(c => d.innerHTML += `<div class="p-card"><span>${c.v}</span><small>${c.s}</small></div>`);
            document.getElementById('ps').innerText = getBJScore(pHand);
            document.getElementById('ds').innerText = getBJScore(dHand);
            sfx.card();
        }
        function getBJScore(h) {
            let s = 0, a = 0;
            h.forEach(c => {
                if(['J','Q','K'].includes(c.v)) s += 10;
                else if(c.v === 'A') { s += 11; a++; }
                else s += parseInt(c.v);
            });
            while(s > 21 && a > 0) { s -= 10; a--; }
            return s;
        }
        function bjMove(type) {
            if(type === 'hit') {
                pHand.push(deck.pop()); renderBJ();
                if(getBJScore(pHand) > 21) finalizeBJ('lose');
            } else {
                while(getBJScore(dHand) < 17) dHand.push(deck.pop());
                renderBJ();
                const ps = getBJScore(pHand), ds = getBJScore(dHand);
                if(ds > 21 || ps > ds) finalizeBJ('win');
                else if(ps === ds) finalizeBJ('draw');
                else finalizeBJ('lose');
            }
        }
        function finalizeBJ(res) {
            if(res === 'win') updateBalance(bjBet*2);
            else if(res === 'draw') { updateBalance(bjBet); showToast("–ù–ò–ß–¨–Ø"); }
            else { sfx.lose(); showToast("–ü–†–û–ò–ì–†–´–®"); }
            setTimeout(() => openGame('blackjack'), 1500);
        }

        /* --- –ò–ì–†–ê: –†–£–õ–ï–¢–ö–ê --- */
        function initRoulette(ui) {
            ui.innerHTML = `
                <h2>GRAND ROULETTE</h2>
                <div id="roulette-result" style="background: #222;">?</div>
                <div id="roulette-color-info" style="margin-bottom: 20px; font-weight: 900; color: #aaa;">–í–´–ü–ê–í–®–ò–ô –¶–í–ï–¢</div>
                <div class="bet-input-area">–°–¢–ê–í–ö–ê: <input type="number" id="bet-val" value="50"></div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <button class="btn-glam" style="background:#e11d48" onclick="playRou('red')">RED x2</button>
                    <button class="btn-glam" style="background:#111; border:1px solid #333;" onclick="playRou('black')">BLACK x2</button>
                    <button class="btn-glam" style="background:#10b981; grid-column: span 2;" onclick="playRou('zero')">ZERO x35</button>
                </div>
            `;
        }
        function playRou(pick) {
            const bet = parseInt(document.getElementById('bet-val').value);
            if(bet > state.bal || bet <= 0) return showToast("–ú–ê–õ–û –ú–û–ù–ï–¢");
            updateBalance(-bet);
            const resBox = document.getElementById('roulette-result');
            const infoBox = document.getElementById('roulette-color-info');
            let c = 0;
            const iv = setInterval(() => {
                sfx.spin();
                resBox.innerText = Math.floor(Math.random()*37);
                if(++c > 25) {
                    clearInterval(iv);
                    const num = Math.floor(Math.random()*37);
                    const isRed = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(num);
                    const color = num === 0 ? 'zero' : (isRed ? 'red' : 'black');
                    
                    resBox.innerText = num;
                    resBox.style.background = color === 'zero' ? '#10b981' : (color === 'red' ? '#e11d48' : '#111');
                    infoBox.innerText = color.toUpperCase();
                    infoBox.style.color = resBox.style.background;

                    if(pick === color) updateBalance(color === 'zero' ? bet*35 : bet*2);
                    else sfx.lose();
                }
            }, 60);
        }

        /* --- –ò–ì–†–ê: –ö–û–°–¢–ò --- */
        function initDice(ui) {
            ui.innerHTML = `
                <h2>ORBITAL DICE</h2>
                <div id="dice-res" style="font-size: 80px; margin: 30px;">üé≤ üé≤</div>
                <div class="bet-input-area">–°–¢–ê–í–ö–ê: <input type="number" id="bet-val" value="50"></div><br>
                <div style="display:flex; gap:10px; justify-content:center;">
                    <button class="btn-glam" onclick="playDice('even')">–ß–ï–¢–ù–û–ï x2</button>
                    <button class="btn-glam" onclick="playDice('odd')">–ù–ï–ß–ï–¢–ù–û–ï x2</button>
                </div>
            `;
        }
        function playDice(pick) {
            const bet = parseInt(document.getElementById('bet-val').value);
            if(bet > state.bal || bet <= 0) return;
            updateBalance(-bet);
            const d1 = Math.floor(Math.random()*6)+1, d2 = Math.floor(Math.random()*6)+1;
            const res = d1 + d2;
            const ems = ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];
            document.getElementById('dice-res').innerText = `${ems[d1-1]} ${ems[d2-1]}`;
            const isEven = res % 2 === 0;
            if((pick === 'even' && isEven) || (pick === 'odd' && !isEven)) updateBalance(bet*2);
            else sfx.lose();
        }

        /* --- –ò–ì–†–ê: –¶–ê–†–ê–ü–ö–ê --- */
        function initScratch(ui) {
            const now = Date.now();
            if(now - state.lastScratch < 3600000) {
                const diff = 3600000 - (now - state.lastScratch);
                const mins = Math.ceil(diff / 60000);
                ui.innerHTML = `<h2>SCRATCH LUCK</h2><p style="margin:20px 0;">–î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ ${mins} –º–∏–Ω.</p>`;
                return;
            }

            ui.innerHTML = `
                <h2>SCRATCH LUCK</h2>
                <div style="position:relative; width:300px; height:150px; margin:0 auto;">
                    <canvas id="scratch-canvas" width="300" height="150" style="position:absolute; top:0; left:0; z-index:2;"></canvas>
                    <div style="position:absolute; top:0; left:0; width:300px; height:150px; background:#111; color:#ffcc00; display:flex; align-items:center; justify-content:center; font-size:30px; font-weight:bold; border-radius:30px; z-index:1;">üí∞ 1000</div>
                </div>
                <p style="margin-top:20px; opacity:0.5;">–°–æ—Ç—Ä–∏ 70% —Å–ª–æ—è, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ 1000 üí∞!</p>
            `;
            const canv = document.getElementById('scratch-canvas');
            const c = canv.getContext('2d');
            
            c.fillStyle = '#444'; 
            c.beginPath();
            c.roundRect(0, 0, 300, 150, 30);
            c.fill();
            
            let isDown = false;
            
            function handleStart() { isDown = true; }
            function handleEnd() { isDown = false; }
            function handleMove(e) {
                if(!isDown) return;
                const r = canv.getBoundingClientRect();
                const clientX = e.clientX || (e.touches ? e.touches[0].clientX : 0);
                const clientY = e.clientY || (e.touches ? e.touches[0].clientY : 0);
                const x = clientX - r.left;
                const y = clientY - r.top;
                c.globalCompositeOperation = 'destination-out';
                c.beginPath(); c.arc(x, y, 20, 0, 7); c.fill();
                checkScratch(c, 1000);
            }

            canv.addEventListener('mousedown', handleStart);
            canv.addEventListener('touchstart', (e) => { handleStart(); e.preventDefault(); }, {passive: false});
            window.addEventListener('mouseup', handleEnd);
            window.addEventListener('touchend', handleEnd);
            canv.addEventListener('mousemove', handleMove);
            canv.addEventListener('touchmove', (e) => { handleMove(e); e.preventDefault(); }, {passive: false});
        }
        
        let scratchClaimed = false;
        function checkScratch(c, p) {
            if(scratchClaimed) return;
            const data = c.getImageData(0,0,300,150).data;
            let count = 0;
            for(let i=3; i<data.length; i+=4) if(data[i] === 0) count++;
            if(count > 32000) { 
                scratchClaimed = true; 
                state.lastScratch = Date.now();
                updateBalance(p); 
                setTimeout(() => { scratchClaimed = false; closeModal(); }, 2000);
            }
        }

        /* --- –ú–ê–ì–ê–ó–ò–ù --- */
        function initShop(ui) {
            const themes = [
                {id: 'theme-default', name: 'NEON BLUE', price: 0},
                {id: 'theme-emerald', name: 'EMERALD LUX', price: 5000},
                {id: 'theme-ruby', name: 'RUBY DARK', price: 15000},
                {id: 'theme-gold', name: 'PURE GOLD', price: 50000}
            ];
            ui.innerHTML = `<h2>THE VAULT</h2><br>`;
            themes.forEach(t => {
                const owned = state.unlocked.includes(t.id);
                ui.innerHTML += `
                    <div style="display:flex; justify-content:space-between; align-items:center; padding:20px; background:var(--surface); border-radius:20px; margin-bottom:10px; border: 1px solid var(--border);">
                        <span>${t.name}</span>
                        <button class="btn-glam" style="padding:10px 20px; font-size:12px;" onclick="buyTheme('${t.id}', ${t.price})">
                            ${owned ? (state.theme === t.id ? 'ACTIVE' : 'SELECT') : t.price + ' üí∞'}
                        </button>
                    </div>
                `;
            });
        }
        function buyTheme(id, p) {
            if(state.unlocked.includes(id)) { state.theme = id; applyTheme(id); openGame('shop'); }
            else if(state.bal >= p) { updateBalance(-p); state.unlocked.push(id); state.theme = id; applyTheme(id); openGame('shop'); }
            else showToast("–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –°–†–ï–î–°–¢–í");
        }
        function applyTheme(id) { document.body.className = id; save(); }

        /* --- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò --- */
        function spinDaily() {
            const now = Date.now();
            if(now - state.lastDaily < 86400000) return;
            const deg = 1800 + Math.random()*1800;
            document.getElementById('main-wheel').style.transform = `rotate(${deg}deg)`;
            document.getElementById('daily-btn').disabled = true;
            state.lastDaily = now;
            setTimeout(()=> { updateBalance(500); save(); updateTimer(); }, 5000);
        }
        function updateTimer() {
            const left = 86400000 - (Date.now() - state.lastDaily);
            const timerEl = document.getElementById('timer');
            if(left > 0 && timerEl) {
                const h = Math.floor(left/3600000);
                timerEl.innerText = `–î–û–°–¢–£–ü–ù–û –ß–ï–†–ï–ó ${h}—á.`;
                document.getElementById('daily-btn').disabled = true;
            }
        }
        function watchFakeAd() {
            showToast("–ó–ê–ì–†–£–ó–ö–ê –†–ï–ö–õ–ê–ú–´...");
            setTimeout(()=>updateBalance(250), 2500);
        }
        function claimReferral() {
            if(state.refClaimed) return alert("–í—ã —É–∂–µ –≤–≤–æ–¥–∏–ª–∏ –∫–æ–¥!");
            const code = document.getElementById('friend-code').value;
            if(code.length > 3) {
                state.refClaimed = true;
                updateBalance(500);
                alert("–ö–æ–¥ –ø—Ä–∏–Ω—è—Ç! +500 –º–æ–Ω–µ—Ç");
            }
        }
        function scrollToGrid() { document.getElementById('game-grid').scrollIntoView({behavior:'smooth'}); }
        function hardReset() { if(confirm("–£–î–ê–õ–ò–¢–¨ –í–°–ï? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.")) { localStorage.clear(); location.reload(); } }

        /* --- –°–¢–ê–†–¢ --- */
        load(); 
        updateTimer();
    </script>
</body>
</html>
